<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ateliê Epistolar</title>
    
    <!-- Tailwind CSS para um design rápido e responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tone.js para gerar os sons da máquina de escrever dinamicamente -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>

    <!-- Fonte para a interface e para a máquina de escrever -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Special+Elite&display=swap" rel="stylesheet">

    <style>
        /* Estilos personalizados */
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* A fonte que simula a máquina de escrever */
        .font-typewriter {
            font-family: 'Special Elite', monospace;
        }

        /* Esconde a área de texto real, mas a mantém acessível */
        #hidden-textarea {
            position: absolute;
            left: -9999px;
            top: 0;
            opacity: 0;
            width: 1px;
            height: 1px;
        }

        /* Estilos base para o papel */
        #paper {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease-in-out;
            cursor: text;
        }

        /* Estilos específicos para cada tipo de papel */
        .paper-linho-marfim {
            background-color: #FDFBF5;
            border: 1px solid #EAE6DA;
        }

        .paper-pergaminho-salinas {
            background-color: #F5EEDC;
            background-image: 
                linear-gradient(rgba(210, 180, 140, 0.15) 1px, transparent 1px),
                linear-gradient(90deg, rgba(210, 180, 140, 0.15) 1px, transparent 1px);
            background-size: 20px 20px;
            border: 1px solid #D2B48C;
            box-shadow: 0 10px 30px rgba(80, 50, 20, 0.2);
        }
        
        .paper-rascunho-poeta {
            background-color: #FFFFFF;
            background-image:
                repeating-linear-gradient(to bottom, 
                    transparent, 
                    transparent 24px, 
                    #E2E8F0 24px, 
                    #E2E8F0 25px);
            border-left: 3px solid #F87171;
        }
        
        /* Animação do cursor piscando */
        #cursor {
            display: inline-block;
            width: 8px;
            height: 1.2em;
            background-color: #333;
            animation: blink 1s step-end infinite;
            vertical-align: bottom;
        }

        @keyframes blink {
            from, to { background-color: transparent; }
            50% { background-color: #333; }
        }

        /* Estilo para os botões de controle */
        .control-button {
            transition: all 0.2s ease;
        }
        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <!-- TELA 1: SELEÇÃO DE PAPEL -->
    <div id="paper-selection-screen" class="w-full max-w-4xl text-center">
        <h1 class="text-4xl md:text-5xl font-bold mb-4 font-typewriter">Ateliê Epistolar</h1>
        
        <!-- TEXTO POÉTICO INTRODUTÓRIO -->
        <div class="text-lg text-gray-600 mb-10 mx-auto max-w-2xl space-y-4">
            <p>Num tempo de palavras apressadas, que nascem e morrem no mesmo instante, este é um refúgio.</p>
            <p>Um lugar para a pausa. Para sentir o peso de cada letra, o som de cada ideia a tomar forma. Um ato de resistência contra o efémero.</p>
            <p class="font-semibold">Escolha o seu papel. Dê tempo ao seu pensamento. Escreva para que permaneça.</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Opção 1: Papel Linho Marfim -->
            <div class="paper-option bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow cursor-pointer" data-paper-type="paper-linho-marfim">
                <div class="w-full h-32 paper-linho-marfim rounded mb-4 border"></div>
                <h2 class="text-xl font-bold mb-2">Papel Linho Marfim</h2>
                <p class="text-gray-600">Um clássico atemporal. Ideal para uma correspondência elegante ou uma reflexão profunda.</p>
            </div>
            
            <!-- Opção 2: Pergaminho Salinas -->
            <div class="paper-option bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow cursor-pointer" data-paper-type="paper-pergaminho-salinas">
                <div class="w-full h-32 paper-pergaminho-salinas rounded mb-4 border"></div>
                <h2 class="text-xl font-bold mb-2">Pergaminho "Salinas, 1920"</h2>
                <p class="text-gray-600">Um papel envelhecido, para cartas que dialogam com a própria História e a memória.</p>
            </div>

            <!-- Opção 3: Rascunho do Poeta -->
            <div class="paper-option bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow cursor-pointer" data-paper-type="paper-rascunho-poeta">
                <div class="w-full h-32 paper-rascunho-poeta rounded mb-4 border"></div>
                <h2 class="text-xl font-bold mb-2">Rascunho do Poeta</h2>
                <p class="text-gray-600">Para o pensamento em ebulição, crônicas do cotidiano e a urgência da inspiração.</p>
            </div>
        </div>
    </div>

    <!-- TELA 2: ESCRITA DA CARTA -->
    <div id="writing-screen" class="hidden w-full h-full flex flex-col items-center">
        <!-- A área de texto oculta que realmente captura a digitação -->
        <textarea id="hidden-textarea" autofocus></textarea>
        
        <!-- A representação visual do papel e do texto -->
        <div id="paper" class="w-full max-w-3xl h-[80vh] p-8 md:p-12 overflow-y-auto font-typewriter text-2xl leading-loose">
            <span id="paper-content"></span><span id="cursor"></span>
        </div>
        
        <!-- Controles para compartilhar e voltar -->
        <div id="controls" class="mt-6 flex flex-wrap gap-4 justify-center">
            <button id="btn-email" class="control-button bg-blue-600 text-white font-bold py-2 px-5 rounded-lg">Enviar por Email</button>
            <button id="btn-copy" class="control-button bg-green-600 text-white font-bold py-2 px-5 rounded-lg">Copiar Texto</button>
            <button id="btn-back" class="control-button bg-gray-500 text-white font-bold py-2 px-5 rounded-lg">Trocar Papel</button>
        </div>
        <div id="copy-feedback" class="mt-2 text-green-700 font-semibold opacity-0 transition-opacity">Texto copiado para a área de transferência!</div>
    </div>

    <script>
        // --- Elementos do DOM ---
        const paperSelectionScreen = document.getElementById('paper-selection-screen');
        const writingScreen = document.getElementById('writing-screen');
        const paperOptions = document.querySelectorAll('.paper-option');
        const paper = document.getElementById('paper');
        const paperContent = document.getElementById('paper-content');
        const hiddenTextarea = document.getElementById('hidden-textarea');
        const btnEmail = document.getElementById('btn-email');
        const btnCopy = document.getElementById('btn-copy');
        const btnBack = document.getElementById('btn-back');
        const copyFeedback = document.getElementById('copy-feedback');

        let currentText = '';

        // --- Configuração dos Sons com Tone.js ---
        const keyClickSound = new Tone.MembraneSynth({
            pitchDecay: 0.01,
            octaves: 6,
            oscillator: { type: 'square' },
            envelope: {
                attack: 0.001,
                decay: 0.2,
                sustain: 0.01,
                release: 0.2,
            }
        }).toDestination();
        keyClickSound.volume.value = -10;

        const plingSound = new Tone.MetalSynth({
            frequency: 400,
            envelope: { attack: 0.001, decay: 0.4, release: 0.2 },
            harmonicity: 8.1,
            modulationIndex: 40,
            resonance: 3000,
            octaves: 1.5
        }).toDestination();
        plingSound.volume.value = -8;

        const carriageReturnSound = new Tone.NoiseSynth({
            noise: { type: 'white' },
            envelope: { attack: 0.005, decay: 0.1, sustain: 0 }
        }).toDestination();
        carriageReturnSound.volume.value = -15;

        // --- Lógica da Aplicação ---

        // 1. Seleção do Papel
        paperOptions.forEach(option => {
            option.addEventListener('click', () => {
                const paperType = option.getAttribute('data-paper-type');
                
                paper.className = `w-full max-w-3xl h-[80vh] p-8 md:p-12 overflow-y-auto font-typewriter text-2xl leading-loose ${paperType}`;
                
                paperSelectionScreen.classList.add('hidden');
                writingScreen.classList.remove('hidden');
                
                hiddenTextarea.focus();
                
                Tone.start();
            });
        });

        // 2. Simulação da Digitação
        paper.addEventListener('click', () => {
            hiddenTextarea.focus();
        });

        hiddenTextarea.addEventListener('input', (e) => {
            currentText = e.target.value;
            paperContent.innerHTML = currentText.replace(/\n/g, '<br>');
            keyClickSound.triggerAttack('C2');
            paper.scrollTop = paper.scrollHeight;
        });

        hiddenTextarea.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                plingSound.triggerAttackRelease('C5', '8n', Tone.now());
                carriageReturnSound.triggerAttackRelease('0.1', Tone.now() + 0.1);
            } else if (e.key === 'Backspace') {
                keyClickSound.triggerAttack('A1');
            }
        });

        // 3. Controles
        btnBack.addEventListener('click', () => {
            hiddenTextarea.value = '';
            currentText = '';
            paperContent.innerHTML = '';
            writingScreen.classList.add('hidden');
            paperSelectionScreen.classList.remove('hidden');
        });

        btnCopy.addEventListener('click', () => {
            navigator.clipboard.writeText(currentText).then(() => {
                copyFeedback.classList.remove('opacity-0');
                setTimeout(() => {
                    copyFeedback.classList.add('opacity-0');
                }, 2000);
            }).catch(err => {
                console.error('Erro ao copiar texto: ', err);
            });
        });

        btnEmail.addEventListener('click', () => {
            const subject = "Uma carta do Ateliê Epistolar";
            const body = encodeURIComponent(currentText);
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
        });

    </script>
</body>
</html>
